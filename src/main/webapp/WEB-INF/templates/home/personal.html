<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Home</title>
    <link rel="stylesheet" href="css/personal.css" th:href="@{/css/personal.css}"/>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
</head>
<body>
<nav>
    <img class="logo" src="/images/logo-removebg-preview.png" th:src="@{/images/logo-removebg-preview.png}" alt="Hanze Logo">
    <ul class="nav__links">
        <li><a class="fileButton panelButtons">New Files</a></li>
        <li><a class="projectButton panelButtons">Personal Files</a></li>
        <li><a class="analysisButton panelButtons">Analysis</a></li>
        <li><a class="logoutButton">Logout</a></li>
    </ul>
</nav>

<div class="container">
    <div id="project-panel" class="personal">
        <div class="titles">
            <h3 class="all-button">All Personal Files</h3>
            <h3 class="active project-button">Personal Projects</h3>
        </div>
        <div class="all-personal-files tile">
            <div class="search">
                <input type="text" placeholder="Search.." onkeyup="filterPersonalFunction()" id="filterPersonalInput">
            </div>
            <div class="personal-file-list">
                <th:block th:each="files : ${testFiles}">
                    <div class="file-container">
                        <div class="file-info">
                            <div class="name" th:text="${files.fileName}"></div>
                            <div class="read">Read</div>
                            <div class="label">Label</div>
                            <div class="del del-button">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <line x1="4" y1="7" x2="20" y2="7"></line>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                </svg>
                            </div>
                            <div class="edit edit-button">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                </svg>
                            </div>
                        </div>
                        <div class="file-edit">
                            <input type="text" name="filename" id="filename" required placeholder="Filename" class="form-element">
                            <input type="text" name="read" id="read" required placeholder="Read" class="form-element">
                            <input type="text" name="label" id="label" required placeholder="Label" class="form-element">
                            <div class="change-button">Edit</div>
                        </div>
                    </div>
                </th:block>
            </div>
        </div>
        <div class="all-projects tile">
            <div class="search">
                <input type="text" placeholder="Search.." onkeyup="filterProjectFunction()" id="filterProjectsInput">
            </div>
            <div class="personal-projects">
                <th:block th:each="project : ${projects}">
                    <div class="project">
                        <div class="title">
                            <span class="projectName">
                                <p>
                                <input type="text" name="projectname" th:value="${project.name}" class="form-element special-form thick-form">
                                <span th:text="${project.fileSize}"></span> files</p>
                            </span>
                            <div class="download-project">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="25"
                                     height="25"
                                     preserveAspectRatio="xMidYMid meet"
                                     viewBox="0 0 24 24"
                                     class="icon icon-tabler icon-tabler-download">
                                    <path d="M19 13v5c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1v-5c0-.55-.45-1-1-1s-1 .45-1 1v6c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1zm-6-.33l1.88-1.88a.996.996 0 1 1 1.41 1.41l-3.59 3.59a.996.996 0 0 1-1.41 0L7.7 12.2a.996.996 0 1 1 1.41-1.41L11 12.67V4c0-.55.45-1 1-1s1 .45 1 1v8.67z"/>
                                </svg>
                            </div>
                            <div class="del del-project">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="25" height="25" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <line x1="4" y1="7" x2="20" y2="7"></line>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                </svg>
                            </div>
                            <div class="icon">
                                <div class="maximize active">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrows-maximize" width="25" height="25" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                        <polyline points="16 4 20 4 20 8"></polyline>
                                        <line x1="14" y1="10" x2="20" y2="4"></line>
                                        <polyline points="8 20 4 20 4 16"></polyline>
                                        <line x1="4" y1="20" x2="10" y2="14"></line>
                                        <polyline points="16 20 20 20 20 16"></polyline>
                                        <line x1="14" y1="14" x2="20" y2="20"></line>
                                        <polyline points="8 4 4 4 4 8"></polyline>
                                        <line x1="4" y1="4" x2="10" y2="10"></line>
                                    </svg>
                                </div>
                                <div class="minimize">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrows-minimize" width="25" height="25" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                        <polyline points="5 9 9 9 9 5"></polyline>
                                        <line x1="3" y1="3" x2="9" y2="9"></line>
                                        <polyline points="5 15 9 15 9 19"></polyline>
                                        <line x1="3" y1="21" x2="9" y2="15"></line>
                                        <polyline points="19 9 15 9 15 5"></polyline>
                                        <line x1="15" y1="9" x2="21" y2="3"></line>
                                        <polyline points="19 15 15 15 15 19"></polyline>
                                        <line x1="15" y1="15" x2="21" y2="21"></line>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="project-edit" th:each="labeledFile : ${project.labeledFiles}">
                            <div>
                                <input type="text" name="filename" id="filename" th:value="${labeledFile.label}" class="form-element special-form">
                            </div>
                            <div class="read-c">
                                <p>Current Read</p>
                                <input type="text" name="read" th:id="${labeledFile.id}" required placeholder="Read" class="form-element">
                            </div>
                            <div class="download-file">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="25"
                                     height="25"
                                     preserveAspectRatio="xMidYMid meet"
                                     viewBox="0 0 24 24"
                                     class="icon icon-tabler icon-tabler-downloadfile">
                                    <path d="M19 13v5c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1v-5c0-.55-.45-1-1-1s-1 .45-1 1v6c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1zm-6-.33l1.88-1.88a.996.996 0 1 1 1.41 1.41l-3.59 3.59a.996.996 0 0 1-1.41 0L7.7 12.2a.996.996 0 1 1 1.41-1.41L11 12.67V4c0-.55.45-1 1-1s1 .45 1 1v8.67z"/>
                                </svg>
                            </div>
                            <div class="delete-file">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-delfile" width="25" height="25" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <line x1="4" y1="7" x2="20" y2="7"></line>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </th:block>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var del = "<span id='readDelete'><svg xmlns='http://www.w3.org/2000/svg' class='icon icon-tabler icon-tabler-x' width='20' height='20' viewBox='0 0 24 24' stroke-width='2' stroke='rgb(160,160,160)' fill='none' stroke-linecap='round' stroke-linejoin='round'><path stroke='none' d='M0 0h24v24H0z' fill='none'></path><line x1='18' y1='6' x2='6' y2='18'></line><line x1='6' y1='6' x2='18' y2='18'></line></svg></span>";
    $(".all-personal-files").hide();
    function getFiles() {
        //URL TO DOWNLOAD MULTI FILES
        url = "download?allFiles=testplaceholder0.fastq.gz&allFiles=testplaceholder0.fastq.gz";
        // URL TO DOWNLOAD ONE FILE
        // url = "download?allFiles=testplaceholder0.fastq.gz";
        // myvar = [];
        // var url = "download?";
        // $.each($(".inputs .reads").find("p"), function(){
        //     url = url + "allFiles=" + $(this).html().substring(0, $(this).html().indexOf('<spa')) + "&";
        // });
        var link = document.createElement('a');
        link.href = url;
        // link.id = 'someLink'
        //link.href = url.slice(0,-1);
        link.click()
    }
        $(document).on('click', ".maximize", function () {
            $.each($(this).parent().parent().parent().find('.project-edit'), function(){
                $(this).addClass('show');
                $(this).parent().find('.maximize').removeClass('active');
                $(this).parent().find('.minimize').addClass('active');
            });
        });
        $(document).on('click', ".minimize", function () {
            $.each($(this).parent().parent().parent().find('.project-edit'), function(){
                $(this).removeClass('show');
                $(this).parent().find('.maximize').addClass('active');
                $(this).parent().find('.minimize').removeClass('active');
            });
        });$(document).on('click', ".analysisButton", function () {
            url = "analysis";
            var link = document.createElement('a');
            link.href = url;
            link.click()
        });
        $(document).on('click', ".fileButton", function () {
            url = "welcomeshow";
            var link = document.createElement('a');
            link.href = url;
            link.click()
        });
        $(document).on('click', ".projectButton", function () {
            url = "personal_tab";
            var link = document.createElement('a');
            link.href = url;
            link.click()
        });
        $(document).on('click', ".addFiles", function () {
            $.each($("#current-files li").filter('.selected'), function(){
                $(".chosen-content .files").append("<p class='file-name'>" + $(this).find('.fileName').html() + del + "</p>");
                $(this).removeClass("selected");
            });
            $('.newFiles .addFiles').hide();
        });
        $(document).on('click', '.project-button.existing', function () {
            document.getElementById("add-button-text").textContent = "Add files to project";
            $(this).parent().find(".project-button").removeClass("active");
            $(this).addClass('active');
            $(".new-project").hide();
            $(".existing-project").show();
        });
        $(document).on('click', '.project-button.new', function () {
            document.getElementById("add-button-text").textContent = "Add project to your account";
            $(this).parent().find(".project-button").removeClass("active");
            $(this).addClass('active');
            $(".existing-project").hide();
            $(".new-project").show();
        });
        $(document).on('click', '#readDelete', function () {
            $(this).parent().remove();
        });
        $(document).on('click', '.titles .all-button', function () {
            $(this).addClass('active');
            $('.titles .project-button').removeClass('active');
            $('.all-projects').hide();
            $('.all-personal-files').show();
        });
        $(document).on('click', '.titles .project-button', function () {
            $(this).addClass('active');
            $('.titles .all-button').removeClass('active');
            $('.all-projects').show();
            $('.all-personal-files').hide();
        });
        $(document).on('click', '.del-button', function () {
            var name = $(this).parent().find('.name').html();
            $(this).parent().fadeOut(200, function() {
                $(this).parent().remove();
            });
            $.ajax({
                type: 'GET',
                url: 'deletefile',
                data: {fileName: name},
                success : function (){
                    alert("Succes")
                },
                error : function (){
                    alert("Something went wrong");
                }
            });
        });
        $(document).on('click', '.del-project', function () {
            var projectName = $(this).parent().find('.projectName').find('h4').html();
            $(this).parent().parent().remove();
            $.ajax({
                type: 'GET',
                url: 'projectdelete',
                data: {projectName: projectName},
                success : function (){
                    alert("Succes");
                },
                error : function (){
                    alert("Something went wrong");
                }
            });
        });
        $(document).on('click', '.change-button', function () {
            var fileName = $(this).parent().find('#filename').val();
            var read = $(this).parent().find('#read').val();
            var label = $(this).parent().find('#label').val();
            if (fileName.length === 0 ){
                fileName = $(this).parent().parent().find('.file-info').find('.name').html();
            }
            if (label.length === 0 ){
                label = $(this).parent().parent().find('.file-info').find('.label').html();
            }
            if (read.length === 0 ){
                read = $(this).parent().parent().find('.file-info').find('.read').html();
            }
            $.ajax({
                type: 'GET',
                url: 'editfile',
                data: {fileInfo: [fileName, read, label]},
                success : function (){
                    alert("Succes");
                },
                error : function (){
                    alert("Something went wrong");
                }
            });

            console.log(fileName);
            console.log(read);
            console.log(label);
        });
        $(document).on('click', '.edit-button', function () {
            $(this).parent().parent().find('.file-edit').toggleClass('show');
        });
        $(function(){
            $("#current-files li").draggable({
                cursor: 'move',
                helper: function(){
                    var selected = $("#current-files li.selected");
                    if (selected.length == 0){
                        selected = $(this).addClass('selected');
                    }
                    var container = $('<div/>').attr('id', 'draggingContainer');
                    container.append(selected.clone().removeClass("selected"));
                    return container;
                }
            });
            $(".files").droppable({
                drop: function(event, ui) {
                    $.each($("#current-files li").filter('.selected'), function(){
                        $(".chosen-content .files").append("<p class='file-name'>" + $(this).find('.fileName').html() + del + "</p>");
                        $(this).removeClass("selected");
                    });
                    if ($('.selected').length >= 1) {
                        $('.newFiles .addFiles').show();
                    } else {
                        $('.newFiles .addFiles').hide();
                    }
                }
            });
        });

        lastChecked = null;
        $(document).on('click', "#current-files li", function (e) {
            if (e.ctrlKey){
                $(this).toggleClass("selected");
            }
            if ($('.selected').length >= 1) {
                $('.newFiles .addFiles').show();
            } else {
                $('.newFiles .addFiles').hide();
            }
            if(!lastChecked){
                lastChecked = this;
                return;
            }
            if (e.shiftKey){
                var from = $("#current-files li").index(this);
                var to = $("#current-files li").index(lastChecked);
                var start = Math.min(from, to);
                var end = Math.max(from, to) + 1;
                $.each($("#current-files li").slice(start, end).filter(':not(.selected)'), function(){
                    $(this).addClass("selected");
                });
                if ($('.selected').length >= 1) {
                    $(".addFiles").show();
                } else {
                    $(".addFiles").hide();
                }
            }
            lastChecked = null;
        });
</script>
</body>
</html>